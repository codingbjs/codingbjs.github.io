<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VMS 인터페이스 명세서</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />

    <style>
        /* 기본 스타일링 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #212529;
        }
        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
        }
        h1, h2, h3 {
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
            margin-top: 40px;
            color: #343a40;
        }
        h1 {
            font-size: 2.5em;
            text-align: center;
            border-bottom-width: 3px;
        }

        /* 내비게이션 메뉴 스타일 */
        nav {
            background-color: #343a40;
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            text-align: center;
        }
        nav a {
            color: #ffffff;
            padding: 10px 15px;
            text-decoration: none;
            font-weight: 500;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        nav a:hover {
            background-color: #495057;
        }

        /* 테이블 스타일 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9em;
        }
        th, td {
            border: 1px solid #dee2e6;
            text-align: center;
            padding: 12px;
        }
        th {
            background-color: #e9ecef;
            font-weight: 600;
        }
        td[rowspan] {
            vertical-align: middle;
        }
        tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        /* 코드 블록 스타일 */
        pre {
            /* Prism 테마가 배경, 글자색을 지정하므로 기존 스타일 일부 제거/수정 */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: "Fira Code", "Courier New", monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

<nav>
    <a href="#section-1">송신 패킷</a>
    <a href="#section-2">수신 패킷</a>
    <a href="#section-3">OPCODE</a>
    <a href="#section-4">클래스 설계</a>
</nav>

<div class="container">
    <h1>VMS 인터페이스 설계서</h1>

    <h2 id="section-1">1. 송신 패킷 구조</h2>
    <table>
        <thead>
        <tr>
            <th>SENDER IP</th>
            <th>DESTINATION IP</th>
            <th>CONTROLLER KIND</th>
            <th>CONTROLLER STATION NUMBER</th>
            <th>TOTAL LENGTH</th>
            <th>OPCODE</th>
            <th>DATA FIELD</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><strong>송신지 IP</strong></td>
            <td><strong>목적지 IP</strong></td>
            <td><strong>제어기 종류</strong></td>
            <td><strong>제어기 고유번호</strong></td>
            <td><strong>전체 길이</strong></td>
            <td><strong>운영 코드</strong></td>
            <td><strong>데이터</strong></td>
        </tr>
        <tr>
            <td>16 Byte</td>
            <td>16 Byte</td>
            <td>2 Byte</td>
            <td>4 Byte</td>
            <td>4 Byte</td>
            <td>1 Byte</td>
            <td>N Byte</td>
        </tr>
        <tr>
            <td>송신 시스템(센터)의 IP 주소</td>
            <td>수신 시스템(VMS)의 IP 주소</td>
            <td>장비 종류 코드 (예: 'MS' = VMS)</td>
            <td>노선번호(2 Byte)와 Controller 번호(2 Byte)로 구성된 고유 ID</td>
            <td>OPCODE + DATA FIELD 전체 길이</td>
            <td>메시지 기능을 정의하는 명령어 코드 (예: 0x01 폼 표출)</td>
            <td>OPCODE에 따른 실제 데이터 영역</td>
        </tr>
        </tbody>
    </table>

    <h2 id="section-2">2. 수신 패킷 구조</h2>
    <table>
        <thead>
        <tr>
            <th>SENDER IP</th>
            <th>DESTINATION IP</th>
            <th>CONTROLLER KIND</th>
            <th>CONTROLLER STATION NUMBER</th>
            <th>TOTAL LENGTH</th>
            <th>OPCODE</th>
            <th>DATA FIELD</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><strong>송신지 IP</strong></td>
            <td><strong>목적지 IP</strong></td>
            <td><strong>제어기 종류</strong></td>
            <td><strong>제어기 고유번호</strong></td>
            <td><strong>전체 길이</strong></td>
            <td><strong>운영 코드</strong></td>
            <td><strong>데이터</strong></td>
        </tr>
        <tr>
            <td>16 Byte</td>
            <td>16 Byte</td>
            <td>2 Byte</td>
            <td>4 Byte</td>
            <td>4 Byte</td>
            <td>1 Byte</td>
            <td>N Byte</td>
        </tr>
        <tr>
            <td>송신 시스템(VMS)의 IP 주소</td>
            <td>수신 시스템(센터)의 IP 주소</td>
            <td>장비 종류 코드 (예: 'MS' = VMS)</td>
            <td>자신의 고유 ID를 담아 응답</td>
            <td>OPCODE + DATA FIELD 전체 길이</td>
            <td>메시지 기능을 정의하는 코드 또는 요청받은 OPCODE</td>
            <td>OPCODE에 따른 실제 데이터</td>
        </tr>
        </tbody>
    </table>

    <h2 id="section-3">3. OPCODE</h2>
    <table>
        <thead>
        <tr>
            <th>구분</th>
            <th>OP CODE</th>
            <th>명칭</th>
            <th>센터</th>
            <th>설명</th>
            <th>방향</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td rowspan="2">1</td>
            <td rowspan="2">0xFF</td>
            <td rowspan="2">장비 구분</td>
            <td>송신</td>
            <td>DEVICE ID 요청</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>DEVICE ID 응답</td>
        </tr>
        <tr>
            <td rowspan="2">2</td>
            <td rowspan="2">0x01</td>
            <td rowspan="2">폼 데이터 표출</td>
            <td>송신</td>
            <td>표출할 폼 데이터 송신</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">3</td>
            <td rowspan="2">0x02</td>
            <td rowspan="2">데이터 다운로드</td>
            <td>송신</td>
            <td>INI, CFG, Bitmap, Data파일송신</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">4</td>
            <td rowspan="2">0x03</td>
            <td rowspan="2">데이터 업로드</td>
            <td>송신</td>
            <td>INI, CFG, Bitmap, Data파일 업로드 요구</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>업로드 데이터 전송</td>
        </tr>
        <tr>
            <td rowspan="2">5</td>
            <td rowspan="2">0x04</td>
            <td rowspan="2">VMS 상태제어</td>
            <td>송신</td>
            <td>VMS 제어정보 송신</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">6</td>
            <td rowspan="2">0x05</td>
            <td rowspan="2">VMS Status 요구</td>
            <td>송신</td>
            <td>VMS 상태정보 요구 송신</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>상태 데이터 응답</td>
        </tr>
        <tr>
            <td rowspan="2">7</td>
            <td rowspan="2">0x06</td>
            <td rowspan="2">VMS 파라미터 요구</td>
            <td>송신</td>
            <td>VMS 로컬 상태 요구 송신</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>로컬 상태 데이터 응답</td>
        </tr>
        <tr>
            <td rowspan="2">8</td>
            <td rowspan="2">0x07</td>
            <td rowspan="2">전원 모듈 상태 요구</td>
            <td>송신</td>
            <td>전원 모듈 상태를 검사 결과를 요청한다</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>전원 모듈 상태 데이터 응답</td>
        </tr>
        <tr>
            <td rowspan="2">9</td>
            <td rowspan="2">0x08</td>
            <td rowspan="2">표출 모듈 상태 요구</td>
            <td>송신</td>
            <td>표출 모듈 상태를 검사 결과를 요청한다</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>표출 모듈 상태 데이터 응답</td>
        </tr>
        <tr>
            <td rowspan="2">10</td>
            <td rowspan="2">0x09</td>
            <td rowspan="2">VMS 정지영상 요구</td>
            <td>송신</td>
            <td>현재 표출되는 이미지 송신 요구</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>현재 표출되는 이미지 전송</td>
        </tr>
        <tr>
            <td rowspan="2">11</td>
            <td rowspan="2">0x0A</td>
            <td rowspan="2">VMS Pixel Image 요구</td>
            <td>송신</td>
            <td>VMS LED Pixel 상태요구 송신</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>현재표출중인 LED 상태 Pixel 송신</td>
        </tr>
        <tr>
            <td rowspan="2">12</td>
            <td rowspan="2">0x0B</td>
            <td rowspan="2">현재 표출 폼 Upload</td>
            <td>송신</td>
            <td>Local에서 표출 중인 폼 Upload요구</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>현재표출중인 전체폼 송신</td>
        </tr>
        <tr>
            <td rowspan="2">13</td>
            <td rowspan="2">0x0C</td>
            <td rowspan="2">Download Schedule Form</td>
            <td>송신</td>
            <td>계획된 Form Schedule을 download</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">14</td>
            <td rowspan="2">0x0D</td>
            <td rowspan="2">Display Default Form</td>
            <td>송신</td>
            <td>디폴트 Form표출 요구</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">15</td>
            <td rowspan="2">0x0E</td>
            <td rowspan="2">Download Form</td>
            <td>송신</td>
            <td>Form download</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">16</td>
            <td rowspan="2">0x0F</td>
            <td rowspan="2">Upload Schedule Form</td>
            <td>송신</td>
            <td>스케줄 메시지 업로드 요구</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>스케줄 메세지 전송</td>
        </tr>
        <tr>
            <td rowspan="2">17</td>
            <td rowspan="2">0x10</td>
            <td rowspan="2">Blank</td>
            <td>송신</td>
            <td>schedule 표출</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">18</td>
            <td rowspan="2">0x11</td>
            <td rowspan="2">Display Form ID</td>
            <td>송신</td>
            <td>Form ID에 해당하는 Form 표출</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">19</td>
            <td rowspan="2">0x12</td>
            <td rowspan="2">통신session 유효 확인</td>
            <td>송신</td>
            <td>수신 여부 응답(ACK)</td>
            <td rowspan="2">VMS→SERVER</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>통신session 유효 확인 요청</td>
        </tr>
        <tr>
            <td rowspan="2">20</td>
            <td rowspan="2">0x13</td>
            <td rowspan="2">SignBoard Alarm Control(터널)</td>
            <td>송신</td>
            <td>SignBoard Alarm Control 요구 (터널용)</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK)</td>
        </tr>
        <tr>
            <td rowspan="2">21</td>
            <td rowspan="2">0x14</td>
            <td rowspan="2">Download Font</td>
            <td>송신</td>
            <td>폰트 설정 정보 내리기</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>수신 여부 응답(ACK/NAK)</td>
        </tr>
        <tr>
            <td rowspan="2">22</td>
            <td rowspan="2">0x15</td>
            <td rowspan="2">UpLoad Font</td>
            <td>송신</td>
            <td>폰트설정 정보 올리기</td>
            <td rowspan="2">SERVER↔VMS</td>
        </tr>
        <tr>
            <td>수신</td>
            <td>폰트설정 정보 응답</td>
        </tr>
        </tbody>
    </table>

    <h2 id="section-4">4. VMS 클래스 설계</h2>

    <h3 id="section-4-1">4.1. VmsPacket&lt;T&gt;</h3>
    <pre><code class="language-java">package com.vms.protocol;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * 제네릭을 사용하여 데이터 페이로드의 타입을 지정할 수 있는 VMS 베이스 패킷 클래스입니다.
 *
 * @param &lt;T&gt; 패킷의 data 필드에 담길 데이터 객체의 타입
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class VmsPacket&lt;T&gt; {
    /**
     * 송신지 IP 주소 (16 Bytes)
     */
    private String senderIp;

    /**
     * 목적지 IP 주소 (16 Bytes)
     */
    private String destinationIp;

    /**
     * 제어기 종류 (2 Bytes, 예: "MS")
     */
    private String controllerKind;

    /**
     * 제어기 고유번호 (4 Bytes)
     */
    private ControllerStationNumber stationNumber;

    /**
     * OPCODE와 DATA 필드의 전체 길이 (4 Bytes)
     */
    private int totalLength;

    /**
     * 운영 코드 (1 Byte)
     */
    private OpCode opcode;

    /**
     * 제네릭 타입 T에 해당하는 실제 데이터 객체(Payload)입니다.
     */
    private T data;
}
</code></pre>

    <h3 id="section-4-2">4.2. ControllerStationNumber</h3>
    <pre><code class="language-java">package com.vms.protocol;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * 제어기(VMS)의 고유 번호를 나타내는 클래스입니다.
 * 노선 번호와 컨트롤러 번호로 구성됩니다.
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class ControllerStationNumber {
    /**
     * 노선 번호 (2 Bytes)
     */
    private int lineNo;

    /**
     * 컨트롤러(설비) 번호 (2 Bytes)
     */
    private int controllerNo;
}
</code></pre>

    <h3 id="section-4-3">4.3. OpCode</h3>
    <pre><code class="language-java">package com.vms.protocol;

import java.util.Arrays;

public enum OpCode {
    DEVICE_ID               ((byte) 0xFF, "장비 구분"),
    FORM_DATA_DISPLAY       ((byte) 0x01, "폼 데이터 표출"),
    DATA_DOWNLOAD           ((byte) 0x02, "데이터 다운로드"),
    DATA_UPLOAD             ((byte) 0x03, "데이터 업로드"),
    VMS_CONTROL             ((byte) 0x04, "VMS 상태제어"),
    VMS_STATUS_REQUEST      ((byte) 0x05, "VMS Status 요구"),
    VMS_PARAMETER_REQUEST   ((byte) 0x06, "VMS 파라미터 요구"),
    POWER_MODULE_STATUS     ((byte) 0x07, "전원 모듈 상태 요구"),
    DISPLAY_MODULE_STATUS   ((byte) 0x08, "표출 모듈 상태 요구"),
    VMS_STILL_IMAGE         ((byte) 0x09, "VMS 정지영상 요구"),
    VMS_PIXEL_IMAGE         ((byte) 0x0A, "VMS Pixel Image 요구"),
    CURRENT_FORM_UPLOAD     ((byte) 0x0B, "현재 표출 폼 Upload"),
    DOWNLOAD_SCHEDULE_FORM  ((byte) 0x0C, "Download Schedule Form"),
    DISPLAY_DEFAULT_FORM    ((byte) 0x0D, "Display Default Form"),
    DOWNLOAD_FORM           ((byte) 0x0E, "Download Form"),
    UPLOAD_SCHEDULE_FORM    ((byte) 0x0F, "Upload Schedule Form"),
    BLANK                   ((byte) 0x10, "Blank"),
    DISPLAY_FORM_ID         ((byte) 0x11, "Display Form ID"),
    SESSION_KEEP_ALIVE      ((byte) 0x12, "통신 session 유효 확인"),
    SIGNBOARD_ALARM_CONTROL ((byte) 0x13, "SignBoard Alarm Control(터널)"),
    DOWNLOAD_FONT           ((byte) 0x14, "Download Font"),
    UPLOAD_FONT             ((byte) 0x15, "UpLoad Font");

    private final byte code;
    private final String description;

    OpCode(byte code, String description) {
        this.code = code;
        this.description = description;
    }

    public byte getCode() {
        return code;
    }

    public String getDescription() {
        return description;
    }

    /**
     * byte 값으로부터 해당하는 OpCode enum 상수를 찾아 반환합니다.
     * @param code 찾으려는 opcode의 byte 값
     * @return 해당하는 OpCode 상수
     * @throws IllegalArgumentException 해당하는 OpCode가 없을 경우
     */
    public static OpCode fromByte(byte code) {
        return Arrays.stream(OpCode.values())
                .filter(opCode -> opCode.code == code)
                .findFirst()
                .orElseThrow(() -> new IllegalArgumentException("Unknown OpCode: " + String.format("0x%02X", code)));
    }
}
</code></pre>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
</body>
</html>